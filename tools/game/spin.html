<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin | QALQX Supreme</title>
    <link rel="stylesheet" href="../../style.css">
    <script src="../../app.js" defer></script>
    <style>
        .wheel-container { position: relative; width: 300px; height: 300px; margin: 0 auto; }
        canvas { width: 100%; height: 100%; border-radius: 50%; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .pointer {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent;
            border-top: 30px solid #fff; z-index: 10;
        }
    </style>
</head>
<body>
    <div class="nav"><a href="../../index.html" class="back-btn">‚Üê</a><h2>DECISION WHEEL</h2></div>
    <div class="container">
        
        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="wheel" width="500" height="500"></canvas>
        </div>

        <button onclick="spin()" style="margin: 20px 0; font-size: 1.2rem; padding: 20px;">üé∞ SPIN THE WHEEL</button>

        <textarea id="opts" style="height:100px; font-size:0.9rem;" oninput="drawWheel()">Pizza,Burger,Salad,Sushi,Tacos</textarea>
        <div style="font-size:0.8rem; color:#666; text-align:center;">Separate options with commas</div>

    </div>

    <script>
        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        let currentAngle = 0;
        let isSpinning = false;
        
        function getOptions() {
            return document.getElementById('opts').value.split(',').filter(x => x.trim() !== "");
        }

        function drawWheel() {
            const options = getOptions();
            const arc = (2 * Math.PI) / options.length;
            const radius = 250;
            const colors = ["#FF0055", "#00E5FF", "#FFD700", "#00FF7F", "#9932CC"];

            ctx.clearRect(0,0,500,500);
            
            options.forEach((opt, i) => {
                const angle = currentAngle + (i * arc);
                ctx.beginPath();
                ctx.fillStyle = colors[i % colors.length];
                ctx.moveTo(250, 250);
                ctx.arc(250, 250, radius, angle, angle + arc);
                ctx.lineTo(250, 250);
                ctx.fill();
                ctx.stroke();

                // Text
                ctx.save();
                ctx.translate(250 + Math.cos(angle + arc/2) * 150, 250 + Math.sin(angle + arc/2) * 150);
                ctx.rotate(angle + arc/2 + Math.PI/2);
                ctx.fillStyle = "#000";
                ctx.font = "bold 20px Arial";
                ctx.fillText(opt, -ctx.measureText(opt).width/2, 0);
                ctx.restore();
            });
        }

        function spin() {
            if(isSpinning) return;
            isSpinning = true;
            
            let speed = 0.5 + Math.random(); // Initial kick
            let deceleration = 0.005;
            
            const animate = () => {
                currentAngle += speed;
                speed -= deceleration;
                drawWheel();
                
                if(speed > 0) {
                    requestAnimationFrame(animate);
                } else {
                    isSpinning = false;
                    // Haptic finish
                    if(navigator.vibrate) navigator.vibrate([50, 50, 50]);
                }
            };
            animate();
        }

        drawWheel();
    </script>
</body>
</html>
